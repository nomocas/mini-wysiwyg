!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.MiniWysiwyg=e()}}(function(){return function e(t,n,i){function r(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n?n:e)},l,l.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t){function n(){i.menuInstance&&i.menuInstance.moveToSelection()}function i(e){this.editedNode="string"==typeof e?document.querySelector(e):e,this._value=this.editedNode.innerHTML;var t=this,r=null,o=null,s=function(){r=setTimeout(function(){i.currentlyFocused===t&&(i.currentlyFocused=null),t.clean(),t.update()},10)},c=function(){i.currentlyFocused=t,clearTimeout(r)},a=function(){t.editedNode.contentEditable&&"false"!=t.editedNode.getAttribute("contenteditable")&&(clearTimeout(o),n())},u=function(){t.editedNode.contentEditable&&"false"!=t.editedNode.getAttribute("contenteditable")&&window.getSelection().toString()&&(clearTimeout(o),n())},l=function(){t.editedNode.contentEditable&&"false"!=t.editedNode.getAttribute("contenteditable")&&("none"===i.menuInstance.el.style.display||window.getSelection().toString()||(o=setTimeout(function(){i.menuInstance.hide()},300)))};e.addEventListener("blur",s),e.addEventListener("focus",c),e.addEventListener("dblclick",a),e.addEventListener("mouseup",u),e.addEventListener("click",l),this._destroyer=function(){e.removeEventListener("focus",c),e.removeEventListener("blur",s),e.removeEventListener("dblclick",a),e.removeEventListener("mouseup",u),e.removeEventListener("click",l)}}function r(){i.currentlyFocused&&i.currentlyFocused.editedNode!==document.activeElement&&i.currentlyFocused.editedNode.focus()}var o=e("nomocas-utils/lib/emitter"),s=e("nomocas-webutils/lib//elem"),c=s.elem,a=["undo","redo","bold","italic","insertUnorderedList","insertOrderedList","createLink","unlink"],u={undo:'<i class="fa fa-undo"></i>',redo:'<i class="fa fa-repeat"></i>',bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',insertUnorderedList:'<i class="fa fa-list-ul"></i>',insertOrderedList:'<i class="fa fa-list-ol"></i>',createLink:'<i class="fa fa-link"></i>',unlink:'<i class="fa fa-unlink"></i>'};i.prototype=new o,i.prototype.update=function(){var e=this.editedNode.innerHTML;if(e!==this._value){this._value=e;var t=new CustomEvent("update",{detail:{value:e,node:this.editedNode,wysiwyg:this}});this.emit("update",t)}},i.prototype.html=function(e){return arguments.length?void(this.editedNode.innerHTML=e):this.editedNode.innerHTML},i.prototype.destroy=function(){this._destroyer&&this._destroyer(),this._destroyer=this._value=this.editedNode=null,i.currentlyFocused===this&&(i.currentlyFocused=null)},i.prototype.clean=function(){return i.cleanHTML(this.editedNode),this},i.format=function(e){switch(e){case"h1":case"h2":case"p":document.execCommand("formatBlock",!1,e);break;case"createLink":if(document.execCommand("createLink",!1,"blabla"),!i.menuInstance)break;var t=window.getSelection(),n=t.focusNode;setTimeout(function(){for(var e=n;e&&"A"!==e.tagName;)e=e.parentNode;e&&(e.setAttribute("href",""),e.setAttribute("target","_blank"),i.menuInstance.clearAnchorManager(),i.menuInstance.showAnchorManager(e))},1);break;default:document.execCommand(e,!1,null),"unlink"===e&&i.menuInstance.hideAnchorManager()}r()},i.currentlyFocused=null;var l,d=function(e){e=e||{};var t=c("div",{"class":e.menuClass||"wysiwyg-menu"}),n=c("ul"),r=e.actions||a;t.appendChild(n),this.el=t,r.forEach(function(t){var r=c("li"),o=c("button"),s=e.iconsSet||u[t];o.innerHTML="function"==typeof s?s(t):s,o.addEventListener("click",function(){i.format(t)}),r.appendChild(o),n.appendChild(r)});var o=this,s=c("input",{type:"text",value:"",placeHolder:"href (http://...)"},null,{input:function(e){var t=e.target.value;o.currentAnchor.setAttribute("href",t)}}),d=c("input",{type:"text",value:"",placeHolder:"title"},null,{input:function(e){var t=e.target.value;o.currentAnchor.setAttribute("title",t)}}),f=c("select",{name:"target"},[c("option",{value:"_blank"},["_blank"]),c("option",{value:"_self"},["_self"])],{change:function(e){var t=e.target,n=t.options[t.selectedIndex].value;o.currentAnchor&&o.currentAnchor.setAttribute("target",n)}}),h=c("div",{"class":"wysiwyg-anchor-ui",style:"display:none;"},[s,d,f]);t.appendChild(h),this.anchorUI=h,this.targetSelect=f,this.hrefInput=s,l=function(e){for(var n=e.target;n&&n!==t&&(i.currentlyFocused?n!==i.currentlyFocused.editedNode:!0);)n=n.parentNode;n||o.hide()},this.clearAnchorManager=function(){this.currentAnchor=null,s.value="",d.value="",f.value=null},document.body.addEventListener("click",l),this.currentAnchorParent=null};d.prototype=new o,d.prototype.destroy=function(){document.body.removeEventListener("click",l)},d.prototype.moveToSelection=function(){var e=window.getSelection(),t=e.anchorNode,n=e.getRangeAt(0).getBoundingClientRect();for(this.el.style.left=n.left+n.width/2+"px",this.el.style.top=n.bottom+8+"px",this.show();t&&"A"!==t.tagName&&t!==i.currentlyFocused.editedNode;)t=t.parentNode;t&&"A"===t.tagName?i.menuInstance.showAnchorManager(t):i.menuInstance.hideAnchorManager()},d.prototype.show=function(){s.show(this.el)},d.prototype.hide=function(){this.hideAnchorManager(),s.hide(this.el)},d.prototype.showAnchorManager=function(e){this.currentAnchor=e,s.show(this.anchorUI),this.currentAnchorParent=i.currentlyFocused,this.hrefInput.value=e.getAttribute("href")||"",this.targetSelect.value=e.getAttribute("target")||""},d.prototype.hideAnchorManager=function(){this.currentAnchorParent&&(this.currentAnchorParent.clean(),this.currentAnchorParent.update(),this.currentAnchorParent=null),s.hide(this.anchorUI)},i.menu=function(e){return i.menuInstance?i.menuInstance:i.menuInstance=new d(e)},i.destroyMenu=function(){i.menuInstance&&(i.menuInstance.destroy(),i.menuInstance=null)};var f=/^(?:SPAN|P|DIV)$/,h=/^(?:P|DIV)$/;i.cleanHTML=function(e){for(var t=[].slice.call(e.childNodes),n=0,r=t.length;r>n;++n){var o=t[n];if(o.tagName&&"BR"!==o.tagName)if(f.test(o.tagName)){if(h.test(o.tagName)&&e.insertBefore(c("br"),o),o.textContent){i.cleanHTML(o);for(var s=[].slice.call(o.childNodes),a=0,u=s.length;u>a;++a)e.insertBefore(s[a],o)}e.removeChild(o)}else o.textContent?(i.cleanHTML(o),o.getAttribute("style")&&o.removeAttribute("style")):(o.childNodes.length?e.insertBefore(c("br"),o):console.warn("wysiwyg : child with no childNodes !!!!"),e.removeChild(o))}return e},t.exports=i},{"nomocas-utils/lib/emitter":2,"nomocas-webutils/lib//elem":3}],2:[function(e,t){var n=function(){};n.prototype={on:function(e,t,n){return e="object"==typeof e?e.type:e,this._events=this._events||{},(this._events[e]=this._events[e]||[]).push({fct:t,args:n}),this},off:function(e,t){if(e="object"==typeof e?e.type:e,!this._events||e in this._events==!1)return this;for(var n=this._events[e],i=0,r=n.length;r>i;++i)if(n[i].fct===t){this._events[e].splice(i,1);break}return this},once:function(e,t,n){this._events=this._events||{};var i=function(){this.off(e,i),t.apply(this,arguments)};return(this._events[e]=this._events[e]||[]).push({fct:i,args:n}),this},emit:function(e){if(!this._events||e in this._events==!1||!this._events[e].length)return this;for(var t=this._events[e].slice(),n=[].slice.call(arguments,1),i=0,r=t.length;r>i;i++)t[i].fct.apply(this,t[i].args?t[i].args.concat(n):n);return this}},t.exports=n},{}],3:[function(e,t){function n(e,t,n,i){var r=document.createElement(e);if(t)for(var o in t)"class"===o?r.classList.add(t[o]):r.setAttribute(o,t[o]);if(n&&n.forEach(function(e){e="string"==typeof e?document.createTextNode(e):e,r.appendChild(e)}),i)for(var o in i)r.addEventListener(o,i[o]);return r}t.exports={elem:n,show:function(e){e.style.display="block"},hide:function(e){e.style.display="none"}}},{}]},{},[1])(1)});