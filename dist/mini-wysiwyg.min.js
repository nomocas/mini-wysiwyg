!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.MiniWysiwyg=e()}}(function(){return function e(t,n,i){function r(s,c){if(!n[s]){if(!t[s]){var a="function"==typeof require&&require;if(!c&&a)return a(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n?n:e)},l,l.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){function i(){r.menuInstance&&r.menuInstance.moveToSelection()}function r(e){this.editedNode="string"==typeof e?document.querySelector(e):e,this._value=this.editedNode.innerHTML;var t=this,n=null,o=null,s=function(e){n=setTimeout(function(){r.currentlyFocused===t&&(r.currentlyFocused=null),t.clean(),t.update()},10)},c=function(e){r.currentlyFocused=t,clearTimeout(n)},a=function(e){r.currentlyFocused&&t.editedNode.contentEditable&&(clearTimeout(o),i())},u=function(){r.currentlyFocused&&t.editedNode.contentEditable&&window.getSelection().toString()&&(clearTimeout(o),i())},l=function(){r.menuInstance&&t.editedNode.contentEditable&&("none"===r.menuInstance.el.style.display||window.getSelection().toString()||(o=setTimeout(function(){r.menuInstance.hide()},300)))},d=function(e){""===e.target.innerHTML||"<br>"===e.target.innerHTML?e.target.classList.add("empty"):e.target.classList.remove("empty")};e.addEventListener("focus",c),e.addEventListener("blur",s),e.addEventListener("dblclick",a),e.addEventListener("mouseup",u),e.addEventListener("click",l),e.addEventListener("input",d),this._destroyer=function(){e.removeEventListener("focus",c),e.removeEventListener("blur",s),e.removeEventListener("dblclick",a),e.removeEventListener("mouseup",u),e.removeEventListener("click",l),e.removeEventListener("input",d)}}function o(){r.currentlyFocused&&r.currentlyFocused.editedNode!==document.activeElement&&r.currentlyFocused.editedNode.focus()}var s=e("nomocas-utils/lib/emitter"),c=e("nomocas-webutils/lib/elem"),a=c.elem,u=["undo","redo","bold","italic","insertUnorderedList","insertOrderedList","createLink","unlink"],l={undo:'<i class="fa fa-undo"></i>',redo:'<i class="fa fa-repeat"></i>',bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',insertUnorderedList:'<i class="fa fa-list-ul"></i>',insertOrderedList:'<i class="fa fa-list-ol"></i>',createLink:'<i class="fa fa-link"></i>',unlink:'<i class="fa fa-unlink"></i>'};r.prototype=new s,r.prototype.update=function(){var e=this.editedNode.innerHTML;if(e!==this._value){this._value=e;var t=new CustomEvent("update",{detail:{value:e,node:this.editedNode,wysiwyg:this}});this.emit("update",t)}},r.prototype.html=function(e){return arguments.length?void(this.editedNode.innerHTML=e):this.editedNode.innerHTML},r.prototype.destroy=function(e){this._destroyer&&this._destroyer(),this._destroyer=this._value=this.editedNode=null,r.currentlyFocused===this&&(r.currentlyFocused=null)},r.prototype.clean=function(){return r.cleanHTML(this.editedNode),"<br>"===this.editedNode.innerHTML&&(this.editedNode.textContent=""),this},r.update=function(){r.currentlyFocused&&(r.currentlyFocused.clean(),r.currentlyFocused.update())},r.format=function(e){switch(e){case"h1":case"h2":case"p":document.execCommand("formatBlock",!1,e);break;case"createLink":if(document.execCommand("createLink",!1,"blabla"),!r.menuInstance)break;var t=window.getSelection(),n=t.focusNode;setTimeout(function(){for(var e=n;e&&"A"!==e.tagName;)e=e.parentNode;e&&(e.setAttribute("href",""),e.setAttribute("target","_blank"),r.menuInstance.clearAnchorManager(),r.menuInstance.showAnchorManager(e))},1);break;default:document.execCommand(e,!1,null),"unlink"===e&&r.menuInstance.hideAnchorManager()}o()},r.currentlyFocused=null;var d=function(e){e=e||{};var t=a("div",{class:e.menuClass||"wysiwyg-menu"}),n=a("ul"),i=e.actions||u;t.appendChild(n),this.el=t,i.forEach(function(t){var i=a("li"),o=a("button"),s=e.iconsSet||l[t];o.innerHTML="function"==typeof s?s(t):s,o.addEventListener("click",function(e){r.format(t)}),i.appendChild(o),n.appendChild(i)});var o=this,s=a("input",{type:"text",value:"",placeHolder:"href (http://...)"},null,{input:function(e){var t=e.target.value;o.currentAnchor.setAttribute("href",t)}}),c=a("input",{type:"text",value:"",placeHolder:"title"},null,{input:function(e){var t=e.target.value;o.currentAnchor.setAttribute("title",t)}}),d=a("select",{name:"target"},[a("option",{value:"_blank"},["_blank"]),a("option",{value:"_self"},["_self"])],{change:function(e){var t=e.target,n=t.options[t.selectedIndex].value;o.currentAnchor&&o.currentAnchor.setAttribute("target",n)}}),f=a("div",{class:"wysiwyg-anchor-ui",style:"display:none;"},[s,c,d]);t.appendChild(f),this.anchorUI=f,this.targetSelect=d,this.hrefInput=s;var h=function(e){if(r.menuInstance.shown()){for(var n=e.target;n&&n!==t&&(!r.currentlyFocused||n!==r.currentlyFocused.editedNode);)n=n.parentNode;n||o.hide()}},p=function(e){if(r.currentlyFocused){for(var n=e.target;n&&n!==r.currentlyFocused.editedNode&&n!==t;)n=n.parentNode;n||(r.update(),o.hide())}};this.clearAnchorManager=function(){this.currentAnchor=null,s.value="",c.value="",d.value=null},document.body.addEventListener("click",h),document.body.addEventListener("mousedown",p),this.destroyers=[function(){document.body.removeEventListener("click",h),document.body.removeEventListener("mousedown",p)}],this.currentAnchorParent=null};d.prototype=new s,d.prototype.destroy=function(){this.destroyers.forEach(function(e){e()})},d.prototype.moveToSelection=function(){var e=window.getSelection(),t=e.getRangeAt(0),n=e.anchorNode,i=e.focusNode,o=t.getBoundingClientRect();if(this.el.style.left=o.left+o.width/2+"px",this.el.style.top=o.bottom+8+"px",this.show(),1===n.nodeType&&1===i.nodeType){var s=n.childNodes[e.anchorOffset],c=i.childNodes[e.focusOffset-1];"A"===s.tagName&&s===c&&(n=s)}for(;n&&"A"!==n.tagName&&n!==r.currentlyFocused.editedNode;)n=n.parentNode;n&&"A"===n.tagName?r.menuInstance.showAnchorManager(n):r.menuInstance.hideAnchorManager()},d.prototype.shown=function(){return"none"!==this.el.style.display},d.prototype.show=function(){c.show(this.el)},d.prototype.hide=function(){this.hideAnchorManager(),c.hide(this.el)},d.prototype.showAnchorManager=function(e){this.currentAnchor=e,c.show(this.anchorUI),this.currentAnchorParent=r.currentlyFocused,this.hrefInput.value=e.getAttribute("href")||"",this.targetSelect.value=e.getAttribute("target")||""},d.prototype.hideAnchorManager=function(){this.currentAnchorParent&&(this.currentAnchorParent.clean(),this.currentAnchorParent.update(),this.currentAnchorParent=null),c.hide(this.anchorUI)},r.menu=function(e){return r.menuInstance?r.menuInstance:r.menuInstance=new d(e)},r.destroyMenu=function(){r.menuInstance&&(r.menuInstance.destroy(),r.menuInstance=null)};var f=/^(?:SPAN|P|DIV)$/,h=/^(?:P|DIV)$/;r.cleanHTML=function(e){for(var t=[].slice.call(e.childNodes),n=0,i=t.length;n<i;++n){var o=t[n];if(o.tagName&&"BR"!==o.tagName)if(f.test(o.tagName)){if(h.test(o.tagName)&&e.insertBefore(a("br"),o),o.textContent){r.cleanHTML(o);for(var s=[].slice.call(o.childNodes),c=0,u=s.length;c<u;++c)e.insertBefore(s[c],o)}e.removeChild(o)}else if(o.textContent){if(r.cleanHTML(o),o.getAttribute("style")&&o.removeAttribute("style"),r.replacer){var l=r.replacer(o);if(l&&l!==o){e.insertBefore(l,o);for(var s=[].slice.call(o.childNodes),c=0,u=s.length;c<u;++c)l.appendChild(s[c]);e.removeChild(o)}}}else o.childNodes.length?e.insertBefore(a("br"),o):console.warn("wysiwyg : child with no childNodes !!!!"),e.removeChild(o)}return e},t.exports=r},{"nomocas-utils/lib/emitter":2,"nomocas-webutils/lib/elem":3}],2:[function(e,t,n){var i=function(){};i.prototype={on:function(e,t,n){return e="object"==typeof e?e.type:e,this._events=this._events||{},(this._events[e]=this._events[e]||[]).push({fct:t,args:n}),this},off:function(e,t){if(e="object"==typeof e?e.type:e,!this._events||e in this._events==!1)return this;for(var n=this._events[e],i=0,r=n.length;i<r;++i)if(n[i].fct===t){this._events[e].splice(i,1);break}return this},once:function(e,t,n){this._events=this._events||{};var i=function(){this.off(e,i),t.apply(this,arguments)};return(this._events[e]=this._events[e]||[]).push({fct:i,args:n}),this},emit:function(e){if(!this._events||e in this._events==!1||!this._events[e].length)return this;for(var t=this._events[e].slice(),n=[].slice.call(arguments,1),i=0,r=t.length;i<r;i++)t[i].fct.apply(this,t[i].args?t[i].args.concat(n):n);return this}},t.exports=i},{}],3:[function(e,t,n){function i(e,t,n,i){var r=document.createElement(e);if(t)for(var o in t)"class"===o?r.classList.add(t[o]):r.setAttribute(o,t[o]);if(n&&n.forEach(function(e){e="string"==typeof e?document.createTextNode(e):e,r.appendChild(e)}),i)for(var o in i)r.addEventListener(o,i[o]);return r}t.exports={elem:i,show:function(e){e.style.display="block"},hide:function(e){e.style.display="none"}}},{}]},{},[1])(1)});